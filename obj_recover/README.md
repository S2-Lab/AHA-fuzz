# Java Object Field Offset Recovery Tool


## Usage

```bash
# Analyze default class (android.content.Intent)
python3 OffsetAnalysis_minimal.py

# Analyze specific class
python3 OffsetAnalysis_minimal.py android.app.Activity

# Specify output file
python3 OffsetAnalysis_minimal.py android.content.Intent my_results.txt

# Enable debug mode
python3 OffsetAnalysis_minimal.py --debug
```

## Input Files

### Required Files
- **Target class definitions**: `input/targetOffset.txt` - Contains field information for target classes
- **OAT assembly code**: `input/boot-framework-oat.log` - Android framework assembly code from oatdump

### framework.jar
Android framework jar file that can be obtained from `/system/framework/framework.jar` on an Android device.

### boot-framework-oat.log
Result of oatdump command that can be generated by:
```bash
adb shell
oatdump --oat-file=/system/framework/arm64/boot-framework.oat > boot-framework-oat.log
```

## File Structure

| File/Directory | Description |
|----------------|-------------|
| `OffsetAnalysis_minimal.py` | Main analysis tool |
| `app-class.sh` | Script to test android.app.* classes from app-class list |
| `content-class.sh` | Script to test android.content.* classes from content-class list |
| `input/boot-framework-oat.log` | OAT file containing Android framework assembly code |
| `input/targetOffset.txt` | Target class definitions and field information |
| `input/framework.jar` | Android framework jar file |
| `soot-project/` | Soot-based analysis framework |

## Example Output

```
Statistics: Direct Mapping: 9, Inference Mapping: 7, Candidate Generation: 0, Not used field: 0

Results:
{'android.content.Intent': {'mAction': '8', 'mCategories': '12', 'mClipData': '16', 
 'mComponent': '20', 'mData': '24', 'mExtras': '28', 'mFlags': '64', ...}}
```

## Batch Analysis Scripts

### Test android.app.* classes
```bash
./app-class.sh
```

### Test android.content.* classes
```bash
./content-class.sh
```

These scripts automatically analyze multiple classes and save results to separate output files.

## Debug Mode

```bash
python3 OffsetAnalysis_minimal.py --debug
```